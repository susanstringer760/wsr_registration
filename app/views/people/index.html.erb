<%= link_to 'New Person', new_person_path %><br>
<%= link_to 'Registration stats', generate_report_path %>

<h1>Listing people</h1>

<table border='1'>
  <tr>
    <th><%= link_to 'Name', people_path(:sort_by=>'last_name') %></th>
    <th>Email</th>
    <th>Phone</th>
    <th>Total</th>
    <th>Paid</th>
    <th><%= link_to 'Balance due', people_path(:sort_by=>'balance_due') %></th>
    <th><%= link_to 'Payment status', people_path(:sort_by=>'payment_status') %></th>
    <th><%= link_to 'Registration status', people_path(:sort_by=>'registration_status') %></th>
    <th colspan='5'>Actions</th>
  </tr>

<% @people.each do |person| %>
  <tr>
    <% name = "#{person.first_name} #{person.last_name}" %>
    <td><%= link_to name, person_path(person.id) %></td>
    <td><%= person.email %></td>
    <td><%= person.phone %></td>
    <td><%= number_to_currency(@prices[person.occupancy]) %></td>
    <td><%= number_to_currency(person.paid_amount) %></td>
    <% if person.balance_due.to_f > 0 %>
      <td class='debit'><%= number_to_currency(person.balance_due.abs) %></td>
    <% else %>
      <td class='credit'><%= number_to_currency(person.balance_due.abs) %></td>
    <% end %>
    <td><%= person.payment_status %></td>
    <td><%= person.registration_status %></td>
    <td><%= link_to 'Show', person %><br>
    <%= link_to 'Edit', edit_person_path(person) %><br>
    <% destroy_msg = "Destroy #{person.first_name} #{person.last_name}?" %>
    <%= link_to 'Destroy', person, method: :delete, data: { confirm: destroy_msg } %></td>
    <td><%= link_to 'Send registration confirmation', mail_confirmation_path(person.id) %></td>
    <td><%= link_to 'Add note', new_person_note_path(:person_id=>person.id) %>
    <td><%= link_to 'General notes', person_notes_path(:person_id=>person.id, :filter_by=>'general') %>
    <td><%= link_to 'Confirmation notes', person_notes_path(:person_id=>person.id, :filter_by=>'confirmation') %>
  </tr>
<% end %>
</table>
<p></p>
<%= link_to 'New Person', new_person_path %><br>
<%= link_to 'Registration report', generate_report_path %>
